
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Lua脚本语言入门[转]</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    </head>

    <body style="margin-top:1.618%">
        <div class="container">
            <div class="row">
                <div class="jumbotron">
                    <h1 class="display-5">Lua脚本语言入门[转]</h1>
                </div>
                <br />
                <nav class="nav">
                    <a class="nav-link active" aria-current="page" href="index_10.html">返回</a>
                </nav>
            </div>

            <hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>sola</b><br/>
2010-08-09 16:39:46</p>
</div>
<div class="col-10">
<p>转自:[url]http://www.dbgger.com/?id=771[/url]<br /><br />在这篇文章中，我想向大家介绍如何进行Lua程序设计。我假设大家都学过至少一门编程语言，比如Basic或C，特别是C。因为Lua的最大用途是在宿主程序中作为脚本使用的。<br />　　Lua 的语法比较简单，学习起来也比较省力，但功能却并不弱。<br />　　在Lua中，一切都是变量，除了关键字。请记住这句话。<br /><br />I. 首先是注释<br />　　写一个程序，总是少不了注释的。<br />　　在Lua中，你可以使用单行注释和多行注释。<br />　　单行注释中，连续两个减号"--"表示注释的开始，一直延续到行末为止。相当于C++语言中的"//"。<br />　　多行注释中，由"--[["表示注释开始，并且一直延续到"]]"为止。这种注释相当于C语言中的"/*…*/"。在注释当中，"[["和"]]"是可以嵌套的。<br />II. Lua编程<br />　　经典的"Hello world"的程序总是被用来开始介绍一种语言。在Lua中，写一个这样的程序很简单：<br />　　print("Hello world")<br />　　在Lua中，语句之间可以用分号"；"隔开，也可以用空白隔开。一般来说，如果多个语句写在同一行的话，建议总是用分号隔开。<br />　　Lua 有好几种程序控制语句，如：<br /><br />　　条件控制：if 条件 then … elseif 条件 then … else … end<br />　　While循环：while 条件 do … end<br />　　Repeat循环：repeat … until 条件<br />　　For循环：for 变量 = 初值，终点值，步进 do … end<br />　　For循环：for 变量1，变量2，… ，变量N in表或枚举函数 do … end<br /><br />　　注意一下，for的循环变量总是只作用于for的局部变量，你也可以省略步进值，这时候，for循环会使用1作为步进值。<br />　　你可以用break来中止一个循环。<br />　　如果你有程序设计的基础，比如你学过Basic，C之类的，你会觉得Lua也不难。但Lua有几个地方是明显不同于这些程序设计语言的，所以请特别注意。<br /><br />　　．语句块<br />　　　　语句块在C++中是用"{"和"}"括起来的，在Lua中，它是用do 和 end 括起来的。比如： <br />　　　　do print("Hello") end<br />　　　　你可以在 函数 中和 语句块 中定局部变量。<br /><br />　　．赋值语句<br />　　　　赋值语句在Lua被强化了。它可以同时给多个变量赋值。<br />　　　　例如：<br />　　　　a,b,c,d=1,2,3,4<br />　　　　甚至是：<br />　　　　a,b=b,a -- 多么方便的交换变量功能啊。<br />　　　　在默认情况下，变量总是认为是全局的。假如你要定义局部变量，则在第一次赋值的时候，需要用local说明。比如：<br />　　　　local a,b,c = 1,2,3 -- a,b,c都是局部变量<br /><br />　　．数值运算<br />　　　　和C语言一样，支持 +, -, *, /。但Lua还多了一个"^"。这表示指数乘方运算。比如2^3 结果为8, 2^4结果为16。<br />　　　　连接两个字符串，可以用".."运处符。如：<br />　　　　"This a " .. "string." -- 等于 "this a string"<br /><br />　　．比较运算<br />　　　　< > <= >= == ~=<br />　　　　分别表示 小于，大于，不大于，不小于，相等，不相等<br />　　　　所有这些操作符总是返回true或false。<br />　　　　对于Table，Function和Userdata类型的数据，只有 == 和 ~=可以用。相等表示两个变量引用的是同一个数据。比如：<br />　　　　a={1,2}<br />　　　　b=a<br />　　　　print(a==b, a~=b) -- true, false<br />　　　　a={1,2}<br />　　　　b={1,2}<br />　　　　print(a==b, a~=b) -- false, true<br /><br />　　．逻辑运算<br />　　　　and, or, not<br />　　　　其中，and 和 or 与C语言区别特别大。<br />　　　　在这里，请先记住，在Lua中，只有false和nil才计算为false，其它任何数据都计算为true，0也是true！<br />　　　　and 和 or的运算结果不是true和false，而是和它的两个操作数相关。<br />　　　　a and b：如果a为false，则返回a；否则返回b<br />　　　　a or b：如果 a 为true，则返回a；否则返回b<br /><br />　　　　举几个例子：<br />　　　　 print(4 and 5) --> 5<br />　　　　 print(nil and 13) --> nil<br />　　　　 print(false and 13) --> false<br />　　　　 print(4 or 5) --> 4<br />　　　　 print(false or 5) --> 5<br /><br />　　　　在Lua中这是很有用的特性，也是比较令人混洧的特性。<br />　　　　我们可以模拟C语言中的语句：x = a? b : c，在Lua中，可以写成：x = a and b or c。<br />　　　　最有用的语句是： x = x or v，它相当于：if not x then x = v end 。<br /><br />　　．运算符优先级，从高到低顺序如下：<br />　　　　^<br />　　　　not - （一元运算）<br />　　　　 * /<br />　　　　 + -<br />　　　　 ..（字符串连接）<br />　　　　 < > <= >= ~= ==<br />　　　　 and<br />　　　　 or<br /><br />III. 关键字<br />　　关键字是不能做为变量的。Lua的关键字不多，就以下几个：<br />　　and break do else elseif<br />　　end false for function if<br />　　in local nil not or<br />　　repeat return then true until　while<br /><br />IV. 变量类型<br />　　怎么确定一个变量是什么类型的呢？大家可以用type()函数来检查。Lua支持的类型有以下几种：<br /><br />　　Nil 空值，所有没有使用过的变量，都是nil。nil既是值，又是类型。<br />　　Boolean 布尔值<br />　　Number 数值，在Lua里，数值相当于C语言的double<br />　　String 字符串，如果你愿意的话，字符串是可以包含''字符的<br />　　Table 关系表类型，这个类型功能比较强大，我们在后面慢慢说。<br />　　Function 函数类型，不要怀疑，函数也是一种类型，也就是说，所有的函数，它本身就是一个变量。<br />　　Userdata 嗯，这个类型专门用来和Lua的宿主打交道的。宿主通常是用C和C++来编写的，在这种情况下，Userdata可以是宿主的任意数据类型，常用的有Struct和指针。<br />　　Thread　　 线程类型，在Lua中没有真正的线程。Lua中可以将一个函数分成几部份运行。如果感兴趣的话，可以去看看Lua的文档。<br /><br />V. 变量的定义<br />　　所有的语言，都要用到变量。在Lua中，不管你在什么地方使用变量，都不需要声明，并且所有的这些变量总是全局变量，除非，你在前面加上"local"。<br />　　这一点要特别注意，因为你可能想在函数里使用局部变量，却忘了用local来说明。<br />　　至于变量名字，它是大小写相关的。也就是说，A和a是两个不同的变量。<br />　　定义一个变量的方法就是赋值。"＝"操作就是用来赋值的<br />　　我们一起来定义几种常用类型的变量吧。<br />　　A. Nil<br />　　　　正如前面所说的，没有使用过的变量的值，都是Nil。有时候我们也需要将一个变量清除，这时候，我们可以直接给变量赋以nil值。如：<br />　　　　var1=nil -- 请注意 nil 一定要小写<br /><br />　　B. Boolean<br />　　　　布尔值通常是用在进行条件判断的时候。布尔值有两种：true 和 false。在Lua中，只有false和nil才被计算为false，而所有任何其它类型的值，都是true。比如0，空串等等，都是true。不要被C语言的习惯所误导，0在Lua中的的确确是true。你也可以直接给一个变量赋以Boolean类型的值，如：<br />　　　　varboolean = true<br /><br />　　C. Number<br />　　　　在Lua中，是没有整数类型的，也不需要。一般情况下，只要数值不是很大（比如不超过100,000,000,000,000），是不会产生舍入误差的。在很多CPU上，实数的运算并不比整数慢。<br />　　　　实数的表示方法，同C语言类似，如：<br />　　　　4 0.4 4.57e-3 0.3e12 5e+20<br /><br />　　D. String<br />　　　　字符串，总是一种非常常用的高级类型。在Lua中，你可以非常方便的定义很长很长的字符串。<br />　　　　字符串在Lua中有几种方法来表示，最通用的方法，是用双引号或单引号来括起一个字符串的，如：<br />　　　　"This is a string."<br />　　　　和C语言相同的，它支持一些转义字符，列表如下：<br />　　　　a bell<br />　　　　b back space<br />　　　　f form feed<br />　　　　n newline<br />　　　　r carriage return<br />　　　　t horizontal tab<br />　　　　v vertical tab<br />　　　　 backslash<br />　　　　" double quote<br />　　　　' single quote<br />　　　　[ left square bracket<br />　　　　] right square bracket<br /><br />　　　　由于这种字符串只能写在一行中，因此，不可避免的要用到转义字符。加入了转义字符的串，看起来实在是不敢恭维，比如：<br />　　　　"one linennext linen"in quotes", 'in quotes'"<br />　　　　一大堆的""符号让人看起来很倒胃口。如果你与我有同感，那么，我们在Lua中，可以用另一种表示方法：用"[["和"]]"将多行的字符串括起来，如：<br />　　　　page = [[<br />　　　　<HTML><br />　　　　　　<HEAD><br />　　　　　　　　<TITLE>An HTML Page</TITLE><br />　　　　　　</HEAD><br />　　　　　　<BODY><br />　　　　　　　　<A HREF="http://www.lua.org">Lua</A><br />　　　　　　　　[[a text between double brackets]]<br />　　　　　　</BODY><br />　　　　</HTML><br />　　　　]]<br /><br />　　　　值得注意的是，在这种字符串中，如果含有单独使用的"[["或"]]"就仍然得用"["或"]"来避免歧义。当然，这种情况是极少会发生的。<br /><br />E. Table<br />　　　　关系表类型，这是一个很强大的类型。我们可以把这个类型看作是一个数组。只是C语言的数组，只能用正整数来作索引；在Lua中，你可以用任意类型来作数组的索引，除了nil。同样，在C语言中，数组的内容只允许一种类型；在Lua中，你也可以用任意类型的值来作数组的内容，除了nil。<br />　　　　Table的定义很简单，它的主要特征是用"{"和"}"来括起一系列数据元素的。比如：<br /><br />　　　　T1 = {} -- 定义一个空表<br />　　　　T1[1]=10 -- 然后我们就可以象C语言一样来使用它了。<br />　　　　T1["John"]={Age=27, Gender="Male"}<br />　　　　这一句相当于：<br />　　　　T1["John"]={} -- 必须先定义成一个表，还记得未定义的变量是nil类型吗<br />　　　　T1["John"]["Age"]=27<br />　　　　T1["John"]["Gender"]="Male"<br />　　　　当表的索引是字符串的时候，我们可以简写成：<br />　　　　T1.John={}<br />　　　　T1.John.Age=27<br />　　　　T1.John.Gender="Male"<br />　　　　或<br />　　　　T1.John{Age=27, Gender="Male"}<br />　　　　这是一个很强的特性。<br /><br />　　　　在定义表的时候，我们可以把所有的数据内容一起写在"{"和"}"之间，这样子是非常方便，而且很好看。比如，前面的T1的定义，我们可以这么写：<br /><br />　　　　T1=<br />　　　　{<br />　　　　　　10, -- 相当于 [1] = 10<br />　　　　　　[100] = 40,<br />　　　　　　John= -- 如果你原意，你还可以写成：["John"] =<br />　　　　　　{<br />　　　　　　　　Age=27,   -- 如果你原意，你还可以写成：["Age"] =27<br />　　　　　　　　Gender=Male   -- 如果你原意，你还可以写成：["Gender"] =Male<br />　　　　　　},<br />　　　　　　20 -- 相当于 [2] = 20<br />　　　　}<br /><br />　　　　看起来很漂亮，不是吗？我们在写的时候，需要注意三点：<br />　　　　第一，所有元素之间，总是用逗号"，"隔开；<br />　　　　第二，所有索引值都需要用"["和"]"括起来；如果是字符串，还可以去掉引号和中括号；<br />　　　　第三，如果不写索引，则索引就会被认为是数字，并按顺序自动从1往后编；<br /><br />　　　　表类型的构造是如此的方便，以致于常常被人用来代替配置文件。是的，不用怀疑，它比ini文件要漂亮，并且强大的多。<br /><br />　　F. Function<br />　　　　函数，在Lua中，函数的定义也很简单。典型的定义如下：<br />　　　　function add(a,b) -- add 是函数名字，a和b是参数名字<br />　　　　 return a+b -- return 用来返回函数的运行结果<br />　　　　end<br /><br />　　　　请注意，return语言一定要写在end之前。假如你非要在中间放上一句return，那么请写成：do return end。<br />　　　　还记得前面说过，函数也是变量类型吗？上面的函数定义，其实相当于：<br />　　　　add = function (a,b) return a+b end<br />　　　　当你重新给add赋值时，它就不再表示这个函数了。你甚至可以赋给add任意数据，包括nil （这样，你就清除了add变量）。Function是不是很象C语言的函数指针呢？<br /><br />　　　　和C语言一样，Lua的函数可以接受可变参数个数，它同样是用"…"来定义的，比如：<br />　　　　function sum (a,b,…)<br />　　　　如果想取得…所代表的参数，可以在函数中访问arg局部变量（表类型）得到。<br />　　　　如 sum(1,2,3,4)<br />　　　　则，在函数中，a = 1, b = 2, arg = {3, 4}<br />　　　　更可贵的是，它可以同时返回多个结果，比如：<br />　　　　function s()<br />　　　　　　return 1,2,3,4<br />　　　　end<br />　　　　a,b,c,d = s() -- 此时，a = 1, b = 2, c = 3, d = 4<br />前面说过，表类型可以拥有任意类型的值，包括函数！因此，有一个很强大的特性是，拥有函数的表，哦，我想更恰当的应该说是对象吧。Lua可以使用面向对象编程了。不信？那我举例如下：<br /><br />　　　　t =<br />　　　　{<br />　　　　 Age = 27<br />　　　　 add = function(self, n) self.Age = self.Age+n end<br />　　　　}<br />　　　　print(t.Age) -- 27<br />　　　　t.add(t, 10)<br />　　　　print(t.Age) -- 37<br /><br />　　　　不过，t.add(t,10) 这一句实在是有点土对吧？没关系，在Lua中，你可以简写成：<br />　　　　t:add(10)   -- 相当于 t.add(t,10)<br /><br />　　G. Userdata 和 Thread<br />　　　　这两个类型的话题，超出了本文的内容，就不打算细说了。<br /><br />VI. 结束语<br />　　就这么结束了吗？当然不是，接下来，需要用Lua解释器，来帮助你理解和实践了。这篇小文只是帮助你大体了解Lua的语法。如果你有编程基础，相信会很快对Lua上手了。<br />　　就象C语言一样，Lua提供了相当多的标准函数来增强语言的功能。使用这些标准函数，你可以很方便的操作各种数据类型，并处理输入输出。有关这方面的信息，你可以参考《Programming in Lua 》一书，你可以在网络上直接观看电子版，网址为：[url]http://www.lua.org/pil/index.html[/url]<br />　　当然，Lua的最强大的功能是能与宿主程序亲蜜无间的合作，因此，下一篇文章，我会告诉大家，如何在你的程序中使用Lua语言作为脚本，使你的程序和Lua脚本进行交互。<br />---------------------------------------------------------------------------------------------------------<br />使用流程<br />1. 函数的使用<br />以下程序演示了如何在Lua中使用函数, 及局部变量<br />例e02.lua<br />-- functions <br />function pythagorean(a, b)   <br />local c2 = a^2 + b^2   <br />return sqrt(c2) <br />end <br />print(pythagorean(3,4))<br /><br />运行结果<br />5<br /><br />程序说明<br />在Lua中函数的定义格式为:<br />function 函数名(参数)<br />...<br />end<br />与Pascal语言不同, end不需要与begin配对, 只需要在函数结束后打个end就可以了.<br />本例函数的作用是已知直角三角形直角边, 求斜边长度. 参数a,b分别表示直角边长,<br />在函数内定义了local形变量用于存储斜边的平方. 与C语言相同, 定义在函数内的代<br />码不会被直接执行, 只有主程序调用时才会被执行.<br />local表示定义一个局部变量, 如果不加local刚表示c2为一个全局变量, local的作用域<br />是在最里层的end和其配对的关键字之间, 如if ... end, while ... end等。全局变量的<br />作用域是整个程序。<br /><br />2. 循环语句<br />例e03.lua<br />-- Loops <br />for i=1,5 do   <br />print("i is now " .. i) <br />end<br /><br />运行结果<br />i is now 1 <br />i is now 2 <br />i is now 3 <br />i is now 4 <br />i is now 5<br /><br />程序说明<br />这里偶们用到了for语句<br />for 变量 = 参数1, 参数2, 参数3 do<br />循环体<br />end<br />变量将以参数3为步长, 由参数1变化到参数2<br />例如:   <br />for i=1,f(x) do print(i) end<br />for i=10,1,-1 do print(i) end<br /><br />这里print("i is now " .. i)中，偶们用到了..，这是用来连接两个字符串的，<br />偶在(1)的试试看中提到的，不知道你们答对了没有。<br />虽然这里i是一个整型量，Lua在处理的时候会自动转成字符串型，不需偶们费心。<br /><br />3. 条件分支语句<br />例e04.lua<br />-- Loops and conditionals <br />for i=1,5 do<br />print(“i is now “ .. i)<br />  if i < 2 then     <br />  print(“small”)   <br />  elseif i < 4 then     <br />  print(“medium”)   <br />  else     <br />  print(“big”)   <br />  end <br />end<br /><br />运行结果<br />i is now 1 <br />small <br />i is now 2 <br />medium <br />i is now 3 <br />medium <br />i is now 4 <br />big <br />i is now 5 <br />big<br /><br />程序说明<br />if else用法比较简单, 类似于C语言, 不过此处需要注意的是整个if只需要一个end,<br />哪怕用了多个elseif, 也是一个end.<br />例如<br />if op == "+" then<br />  r = a + b<br />elseif op == "-" then<br />  r = a - b<br />elseif op == "*" then<br />  r = a*b<br />elseif op == "/" then<br />  r = a/b<br />else<br />  error("invalid operation")<br />end<br /><br /><br />4.试试看<br />Lua中除了for循环以外, 还支持多种循环, 请用while...do和repeat...until改写本文中的for程序<br />----------------------------------------------------------------------------------------------------------<br />数组的使用<br /><br />1.简介<br />Lua语言只有一种基本数据结构, 那就是table, 所有其他数据结构如数组啦,<br />类啦, 都可以由table实现.<br /><br />2.table的下标<br />例e05.lua<br />-- Arrays <br />myData = {} <br />myData[0] = “foo” <br />myData[1] = 42 <br /><br />-- Hash tables <br />myData[“bar”] = “baz” <br /><br />-- Iterate through the <br />-- structure <br />for key, value in myData do   <br />print(key .. “=“ .. value) <br />end<br /><br />输出结果<br />0=foo <br />1=42 <br />bar=baz<br /><br />程序说明<br />首先定义了一个table myData={}, 然后用数字作为下标赋了两个值给它. 这种<br />定义方法类似于C中的数组, 但与数组不同的是, 每个数组元素不需要为相同类型,<br />就像本例中一个为整型, 一个为字符串.<br /><br />程序第二部分, 以字符串做为下标, 又向table内增加了一个元素. 这种table非常<br />像STL里面的map. table下标可以为Lua所支持的任意基本类型, 除了nil值以外.<br /><br />Lua对Table占用内存的处理是自动的, 如下面这段代码<br />a = {}<br />a["x"] = 10<br />b = a   -- `b' refers to the same table as `a'<br />print(b["x"]) --> 10<br />b["x"] = 20<br />print(a["x"]) --> 20<br />a = nil   -- now only `b' still refers to the table<br />b = nil   -- now there are no references left to the table<br />b和a都指向相同的table, 只占用一块内存, 当执行到a = nil时, b仍然指向table,<br />而当执行到b=nil时, 因为没有指向table的变量了, 所以Lua会自动释放table所占内存<br /><br />3.Table的嵌套<br />Table的使用还可以嵌套，如下例<br />例e06.lua<br />-- Table ‘constructor’ <br />myPolygon = {   <br />color=“blue”,   <br />thickness=2,   <br />npoints=4;   <br />{x=0,   y=0},   <br />{x=-10, y=0},   <br />{x=-5, y=4},   <br />{x=0,   y=4} <br />}<br /><br />-- Print the color <br />print(myPolygon[“color”]) <br /><br />-- Print it again using dot <br />-- notation <br />print(myPolygon.color) <br /><br />-- The points are accessible <br />-- in myPolygon[1] to myPolygon[4] <br /><br />-- Print the second point’s x <br />-- coordinate <br />print(myPolygon[2].x)<br /><br />程序说明<br />首先建立一个table, 与上一例不同的是，在table的constructor里面有{x=0,y=0}, <br />这是什么意思呢？ 这其实就是一个小table, 定义在了大table之内, 小table的<br />table名省略了.<br />最后一行myPolygon[2].x，就是大table里面小table的访问方式.<br />-----------------------------------------------------------------------------------------------------------<br />如何简化你的宏.<br /><br />虽然以上介绍让我们了解道宏可以完成非常强大的功能，但暴雪实在太小气了，仅仅只给我们255个字符来编写宏的内容，假如你的宏的功能比较罗嗦，那就很麻烦了，所以以下我介绍一下一些简化宏的小技巧：<br /><br />1、定义全局变量<br />看完之前Lua介绍的人该都知道把，在Lua里，所有的变量都是全局变量，也就是说任何一个变量只要你在开始游戏后做过定义，那么到游戏结束时只要你不重新定义他都是有效的。但为了不让我们自己不混淆做全局用的变量和局部使用的变量，我们可以采用大小写区分的办法，即大写一律做为全局变量使用，小写都用局部变量。<br />这样，我们可以在一个宏里把自己常用的魔法/技能都定义成变量来表示，比如我是个术士，就可以这样：<br />F="腐蚀术(等级 3)"   X="献祭(等级 3)".......<br />之后，我们要使用这样魔法的时候，只要直接用F或X来代替就可以了，连""都可以省掉，是不是很方便呢~<br />或者还可以把一些常见的API函数变量也自己定义：<br />T="target" P="player".....<br />使用的时候和上面一样。<br /><br />2、自定义函数<br />说实在话，魔兽的有些函数实在长的过头，很多时候珍贵的字节都给函数占去了。所以必要的时候我们就得用自定义函数的方法去简化这些函数。<br />自定义函数的语句为：<br />function 函数名称(函数变量1、函数变量2....) return 函数返回值 end<br />比如，使用法术的这个函数是CastByName()，我们可以在宏里这样写：<br />/scirpt function C(a) CastByName(a) end<br />运行后，我们其他宏使用法术就只要直接用C()就可以了，是不是很方便呢？<br />或是说话的函数：<br />/script function S(a) SendChatMessage(a,"SAY") end<br />之后你要控制人物说话就用S()就可以了。<br /><br />如果是有返回值的函数：<br />/script<br />function N(a)<br />return UNitName(a)       --return之后就是表示函数的返回值,但return必须在end前面.<br />end<br />如果以后你要调用目标的名字，直接用 x=N("target")，如果按前面第一点定义了全局变量的话，更简单x=N(T)。<br /><br />这样，我们就可以把重要的字节都用在宏的判断内容上，而不是沉长的函数上了。如果你还有什么更好的简化方法，可以跟贴哦。<br />-------------------------------------------------------------------------------------------------------<br />关于背包物品使用整理类的宏的制作<br /><br />由于游戏提供的函数无法直接由物品名称调用该物品，所以通常简单的使用物品宏是比较麻烦的，一定要把使用的物品放在背包内特定的位置<br /><br />；或则大多术士都需要的问题，能随时监视自己的灵魂碎片（当然，有插件可以做到这一点）。<br /><br />以下我写写关于如何制作这类宏：<br /><br />首先，我们要在背包里找到自己需要的东西，必须用循环里遍历这些包。由于放的位置有2个参数，1个是包的编号，一个是包内槽位的编号，<br /><br />所以我们需要一个循环嵌套来搜索：<br /><br />以下假设我们身上都是16格的包：<br />for bag=0,4,1 do     --包的编号为从右到左，0,1,2,3,4<br />for cw=1,16,1 do   --槽位的编号为上到下，左到右 1,2,3,4,5......16<br />..............   --这里我们可以写如判断物品是否为我们需要的东西的语句<br />end         --表示内循环结束       <br />end           --外循环结束<br /><br /><br />或者用其他方式做这个循环：<br />While循环：while 条件 do … end<br /><br />Repeat循环：repeat … until 条件<br /><br /><br />然后，要处理的是物品的判断：<br />我们有两个函数可以使用<br />GetContainerItemLink() 和 GetContainerItemInfo()<br />这两个函数使用的变量都是2个，一个是包的编号，一个是槽位的编号，但他们的返回值不同<br /><br />GetContainerItemLink()是返回一个带着物品名字的连接，如果你用聊天函数把返回值说出来就可以看到，说出来的不光是物品的名称，还是<br /><br />一个可以连接到物品详细内容窗口的连接。<br /><br />比如，你的包里4，1的位置放了一块熊肉，那么用/script SendChatMessage(GetContainerItemLink(4,1),"SAY")后，就可以看到自己说“[熊<br /><br />肉]”，而且用鼠标点一下说的内容，还可以弹出一个描写这块肉的窗口。<br /><br />但要注意，直接用"[熊肉]"这样字符串来判断这个物品是不行的，例如：<br /><br />if GetContainerItemLink(4,1)=="[熊肉]" then ..... end<br />这个判断是无效的。<br /><br />正确的方法是，先把要做判断的物品的赋一个变量，再用变量做出判断：<br /><br />rou=GetContainerItemLink(4,1)     --把物品连接值赋给rou<br /><br />if GetContainerItemLink(4,1)==rou then ..... end   --现在就可以正常判断物品了<br /><br />最后要注意的是，这个函数无法对术士的灵魂碎片做出正确的判断，意思就是，虽然灵魂碎片用这个函数显示出来是一样的，但这个函数却认<br /><br />为所有的灵魂碎片都是不同的东西，即你把这个灵魂碎片的连接赋给一个变量后，这个变量就只能判断这个灵魂碎片，其他的灵魂碎片就无法<br /><br />作出判断，奇怪把。所以要判断灵魂碎片，就必须用到第二个函数GetContainerItemInfo()<br /><br />GetContainerItemInfo()的返回值非常多，几乎所有的物品信息都可以返回，但我们这里判断只用它返回的第一个值。<br />我们可以先用聊天函数来看看第一个返回值是什么样子的：<br />/script <br />a=GetContainerItemInfo(4,1)<br />SendChatMessage(a,"SAY")<br /><br />可以看到，返回值相当长的英文，但物品的关键字是在后面。<br /><br />这样，我们就有2种方法来使用这个函数来判断物品。<br /><br />1、和前一个函数的方法一样，用变量存储值后再判断，前提是要把判断的物品放在特定的位置赋一下值。<br />2、只使用特定物品，把物品的判断关键字写在函数里，然后用string.find()来判断他。<br />例子：某物品的关键字是bd<br />if string.find(GetContainerItemInfo(4,1),bd) then .....end --判断包1，4位置是否存在关键字为bd物品。<br /><br /><br />接着要处理的是物品的使用和交换。<br />使用特定背包位置的物品函数：UseContainerItem(index,slot) <br />这个好理解，不用多解释了把。<br /><br />拾取/放下物品的函数：PickupContainerItem(index,slot)<br />这个函数有意思，你鼠标上没抓着东西的时候就是帮你拿起特定位置的物品，有的话就变成放下物品到特定的位置并交换拿起该位置的物品。<br /><br />所以要完成2个物品在包内的交换要使用3次这个函数：<br />PickupContainerItem(4,1) --拿起4，1位置的物品<br />PickupContainerItem(1,4) --放在1，4位置并拿起1，4位置的物品<br />PickupContainerItem(4,1) --把1，4位置的物品放在4，1位置<br /><br /><br />好拉，把以上几点组合后宏就基本完成了：<br /><br />下面的例子是关于灵魂碎片的整理，把前4个包的灵魂碎片全放到最后一个包内：<br /><br /><br />/script<br />bag=0 cw=1 sc=1   --定义好变量，bag是包的编号，cw表示查找包的槽位，sc指向最后一个包内的槽位<br />for bag=0,3,1 do --从0号包开始，到3号包结束，最后一个包不搜索。<br />for cw=1,16,1 do   --这里假设所有的包都是16个槽位的，如果没那么多槽位的包也可以用。<br />if GetContainerItemLink(bag,cw)~=nil --判断这个槽位是否是空的，是空就直接跳到下一个槽位<br />  then <br />  if string.find(GetContainerItemInfo(bag,cw),"Gem") --判断这个槽位里是否是灵魂碎片，Gem为灵魂碎片的关键字<br />  then <br />    while string.find(GetContainerItemInfo(4,sc),"Gem") do sc=sc+1 end <br />        --这是一个小循环，用于判断最后一个包里原来是否已经有灵魂碎片，有的话就指向包的下一个槽位<br />    PickupContainerItem(bag,cw) <br />    PickupContainerItem(4,sc) <br />    PickupContainerItem(bag,cw)   --这3句控制灵魂碎片和最后一个包内物品的交换<br />    sc=sc+1   --重要，不能忘记这个，每放置好一个碎片后就要把最后一个包的<br />        槽位指针指向下一个槽位，上面的小循环是无法判断刚刚放好的碎片的。<br />  end<br />end <br />end <br />end   -循环结束<br /><br />完了么，当然不行。。。因为宏的限制是255个字。所以要简化我们的宏。<br /><br />最长的内容估计就是函数了，就先从简化函数开始：<br /><br />建立以下宏：<br /><br /><br />/script function P(c,d) PickupContainerItem(c,d) end <br />/script function I(e,f) if GetContainerItemInfo(e,f) then return string.find(GetContainerItemInfo(e,f),"Gem") else return nil end end<br /><br />原来的宏就变成了：<br /><br />/script<br />bag=0 cw=1 sc=1   <br />for bag=0,3,1 do <br />for cw=1,16,1 do <br />if G(bag,cw)~=nil <br />  then <br />  if I(bag,cw)<br />  then <br />    while I(4,sc) do sc=sc+1 end <br />    P(bag,cw) <br />    P(4,sc) <br />    P(bag,cw)   <br />    sc=sc+1   <br />  end       <br />end <br />end <br />end <br /><br />多余的变量定义和过长的变量都可以更改：<br /><br /><br />/script<br />s=1   <br />for g=0,3 do <br />for w=1,16 do <br />if G(g,w) <br />  then <br />  if I(g,w)<br />  then <br />    while I(4,s) do s=s+1 end <br />    P(g,w) <br />    P(4,s) <br />    P(g,w)   <br />    s=s+1   <br />  end       <br />end <br />end <br />end <br /><br />现在写的下了吧。呵呵，至于使用物品的宏我虽然已经写好了，但没有测试过，等测试没问题后再放出来把。有兴趣的朋友也可以自己写写。<br /><br />但要注意一点，使用物品的宏只要找到物品就可以马上跳出循环，所以用Repeat循环做比较合适</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>O3龙</b><br/>
2010-08-09 16:39:55</p>
</div>
<div class="col-10">
<p>这个太好了</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>hoj099</b><br/>
2010-08-09 16:40:57</p>
</div>
<div class="col-10">
<p>二项都支持，要常常创新啊~</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>xinyyy78</b><br/>
2010-08-09 16:42:32</p>
</div>
<div class="col-10">
<p>楼主好强大呢~</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>windright</b><br/>
2010-08-09 16:42:54</p>
</div>
<div class="col-10">
<p>回复可见。。。 看看什么东西</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>fanhuai</b><br/>
2010-08-09 16:43:34</p>
</div>
<div class="col-10">
<p>俺的眼睛被闪瞎了</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>猫在散步</b><br/>
2010-08-09 16:43:38</p>
</div>
<div class="col-10">
<p>    这个2ND我有了 ==</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>hoj099</b><br/>
2010-08-09 16:43:41</p>
</div>
<div class="col-10">
<p>说的对，是不什么呢~</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>『兔寳貝』</b><br/>
2010-08-09 16:44:27</p>
</div>
<div class="col-10">
<p><br />219..</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>猫在散步</b><br/>
2010-08-09 16:44:29</p>
</div>
<div class="col-10">
<p>很CJ图。。我看到了</p>
</div>
</div>


            
            <div class="row">
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center">
                    <!--<li class="page-item disabled">
                        <a class="page-link">Previous</a>
                    </li>
                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">Next</a>
                    </li>
                        -->
                        <li class="page-item active">
<a class="page-link" href="post9424_1.html">1</a>
</li>


                    </ul>
                </nav>
            </div>
        </div>


        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    </body>
</html>

