
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>RMDS教程（五）——挑战太阳的人</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    </head>

    <body style="margin-top:1.618%">
        <div class="container">
            <div class="row">
                <div class="jumbotron">
                    <h1 class="display-5">RMDS教程（五）——挑战太阳的人</h1>
                </div>
                <br />
                <nav class="nav">
                    <a class="nav-link active" aria-current="page" href="index_17.html">返回</a>
                </nav>
            </div>

            <hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>雷精灵</b><br/>
2009-09-06 16:07:10</p>
</div>
<div class="col-10">
<p>少年，如果你已经顺利地读到了这一篇教程，那么，可以说，你已经站在你的帝国城门口了。在你的身后，那片被你所征服的土地，已经永远归顺你。那片土地上的民众，从此以后将是你的子民。<br />少年，帝国的城门已经打开。王座上的皇冠，正在等待着它的主人将它捧起。身着红色华丽长袍的大主教，正跪在神像面前祈祷，祈祷他们的王早日降临。<br />少年，抬起你的腿，向前迈出一步吧！你的王国，你的世界，你的宇宙，在你面前的，一切都是你的。<br /><br />上次我们已经成功制作出了一个NPC——加斯敏。这一次我们把可爱的加斯敏放到世界里面，然后亲手控制她。<br /><br />不过，世界模块不仅需要NPC，还需要有地图。目前我们还没有学到如何制作地图，因此我们这次暂且先使用DEMO中现成的地图。<br /><br />准备工作就不说了。我们直接打开CT2，载入ROM，然后从里面导出几个一会将要用到的文件。<br />第0108号文件，“world/Prox.pak”，把这个文件导出来。<br />[attach]1697[/attach]<br /><br />这是普罗克斯的地图资源。之所以选择这个地图，是因为这个地图非常大，很适合做实验。<br /><br />然后你再随便找几个NPC导出来。这几个NPC将作为后面实验中的NPC，用来当做触发的对象。<br />方便起见，我把Alex.pak（阿历克斯，0045号）、Isaac.pak（罗宾，0083号）和Garet.pak（杰拉尔德，0062号）这3个NPC导出来。<br /><br />好，开始写脚本吧！<br />老样子，打开crt0.o.lua，修改参数直接切换到世界模块。<br />[code=rmds]<br />SwitchModule(MODULE_WORLD,"/world/WorldModuleStartUp.lua")<br />[/code]<br /><br />显然，当我们进入世界模块之后，立刻执行世界模块的启动脚本“world/WorldModuleStartUp.lua”。因此我们需要新建一个world文件夹，然后在该文件夹内新建WorldModuleStartUp.lua这个启动脚本。<br /><br />打开WorldModuleStartUp.lua。<br />[code=rmds]<br />CreateScene("/world/SceneProx.lua",-1)<br />[/code]<br />正如上次教程所说的，世界由两大元素构成——场景和事件。我们需要先创建场景。只有把场景“容器”创建出来之后，才能继续创建容器内的东西。<br />根据API手册，此时将创建“/world/SceneProx.lua”这个场景。我们可以看到，场景其实就是一个脚本。因为场景是个“空的容器”，你需要给这个容器添加内容，这个添加内容的过程，自然就写在创建场景的这个脚本中。根据API手册，在载入场景的时候，将随机使用一种切屏特效。<br /><br />OK，现在场景已经有了。不过依然是空的。因为我们还没有往“/world/SceneProx.lua”这个场景中写任何东西。<br />新建SceneProx.lua，打开。<br />[code=rmds]<br />CreateMap("/world/Prox.pak")<br />CreateNPC(0,"/world/Jenna.pak")<br />SetCameraFollow(0)<br />SetNPCXY(0,128,64)<br />SetNPCAction(0,ACT_PLAYERCONTROL)<br />[/code]<br />首先我们创建地图。把刚才导出的Prox.pak复制到world文件夹下，这样脚本就能找到这个地图资源并且载入它了。<br />然后创建NPC。毫无疑问，我们可爱的加斯敏已经迫不及待要当主角了~~~把上次做好的加斯敏的资源改名为Jenna.pak，然后复制到world文件夹下。当这个脚本执行完之后，加斯敏就被创建出来了。她的ID为0。<br />然后让摄像机跟随0号NPC，也就是加斯敏。<br />然后设置0号NPC的坐标为(128,64)。<br />然后设置0号NPC的动作为“玩家控制”。<br /><br />如何？很容易理解吧！我们现在就打包，然后看看效果。<br />[attach]1701[/attach][attach]1702[/attach][attach]1703[/attach]<br />试着按方向键看看~~~试着按住B键再按方向键看看~~~<br /><br />——ああ～～～可愛い！美しい！素晴らしい！[attach]1704[/attach]<br />どうだ？很有RPG的感觉了吧！<br />——嗯！嗯！真是太美了~~~<br />不过先别太兴奋，好戏还在后面呢！我们再加上几个NPC看看。<br /><br />打开刚才的/world/SceneProx.lua这个场景，我们继续往里面添加点东西。<br />[code=rmds]<br />CreateMap("/world/Prox.pak")<br />CreateNPC(0,"/world/Jenna.pak")<br />SetCameraFollow(0)<br />SetNPCXY(0,128,64)<br />SetNPCAction(0,ACT_PLAYERCONTROL)<br /><br />CreateNPC(1,"/world/Alex.pak")<br />SetNPCXY(1,464,288)<br />SetNPCDirection(1,DIR_UP)<br />SetNPCMoveSpeed(1,-32767)<br />SetNPCAction(1,ACT_STAYSTILL)<br /><br />CreateNPC(2,"/world/Garet.pak")<br />SetNPCXY(2,64,328)<br />SetNPCMoveSpeed(2,-32767)<br />SetNPCAction(2,ACT_STANDRANDOM)<br /><br />CreateNPC(3,"/world/Isaac.pak")<br />SetNPCXY(3,80,144)<br />SetNPCAction(3,ACT_WALKAROUND)<br />[/code]<br />第1号NPC是阿历克斯，面向上站着不动；<br />第2号NPC是杰拉尔德，站着不动四处乱瞅；<br />第3号NPC是罗宾，四处乱逛。<br />[attach]1709[/attach][attach]1710[/attach][attach]1711[/attach]<br /><br />——哇啊~~~真的出现了！……等等，和他们对话没有反应哎！<br />那当然！想要让他们有反应，就得调用脚本了。因为只有脚本才可以控制这个世界上的一切。<br />——脚本啊，怎么让NPC身上有脚本呢？……啊！触发器！<br />没错，就是触发器。<br /><br />再次打开/world/SceneProx.lua这个场景，我们再往里面添加点东西。<br />[code=rmds]<br />CreateMap("/world/Prox.pak")<br />CreateNPC(0,"/world/Jenna.pak")<br />SetCameraFollow(0)<br />SetNPCXY(0,128,64)<br />SetNPCAction(0,ACT_PLAYERCONTROL)<br /><br />CreateNPC(1,"/world/Alex.pak")<br />SetNPCXY(1,464,288)<br />SetNPCDirection(1,DIR_UP)<br />SetNPCMoveSpeed(1,-32767)<br />SetNPCAction(1,ACT_STAYSTILL)<br /><br />CreateNPC(2,"/world/Garet.pak")<br />SetNPCXY(2,64,328)<br />SetNPCMoveSpeed(2,-32767)<br />SetNPCAction(2,ACT_STANDRANDOM)<br /><br />CreateNPC(3,"/world/Isaac.pak")<br />SetNPCXY(3,80,144)<br />SetNPCAction(3,ACT_WALKAROUND)<br /><br />CreateTrigger(0,3,-9,-9,18,18,TRIGGER_EVENT,"/world/TalkWithIsaac.lua")<br />[/code]<br />然后新建一个脚本，取名叫“TalkWithIsaac.lua”，在里面写下如下内容：<br />[code=rmds]<br />HookNPC()<br /><br />if G_TRIGGER_NPC==0 then<br />	DisplayDialog(0,0,0,"#a05#s2#v09罗宾！")<br />	WaitForKey(KEY_A)<br />	DisplayDialog(3,0,0,"#a00#s2#v08啥事？")<br />	WaitForKey(KEY_A)<br />	DisplayDialog(0,0,0,"#a05#s2#v09没事。#n测试一下脚本而已。")<br />	WaitForKey(KEY_A)<br />	local tID=ShowBubble(3,0,0,3)<br />	WaitForThreadDie(tID)<br />	DisplayDialog(3,0,0,"#a00#s2#v08你真有聊……")<br />	WaitForKey(KEY_A)<br />end<br /><br />UnhookNPC()<br />[/code]<br /><br />控制加斯敏走到罗宾身边，然后按A键试试看！<br />[attach]1724[/attach]<br /><br />我来解释一下脚本的工作过程。<br />刚才我们在场景中添加了一个触发器。根据API手册，这个触发器的ID号为0号，绑定在第3号NPC，也就是罗宾身上。这个触发器的大小为18*18，触发器矩形的左上角相对于罗宾的中心点偏移量为(-9,-9)。由于触发器的大小为18*18，可见这个触发器正好以罗宾的中心点居中。触发器的触发方式为“事件触发”，也就是说当加斯敏的“事件触发判定点”和这个触发器发生碰撞，且又按下了A键的时候，则会触发“/world/TalkWithIsaac.lua”这个脚本。<br />加斯敏的身位判定框为16*16，用精灵编辑器打开罗宾的资源，可以看到他的身位判定框也是16*16。<br />那么，当加斯敏走到罗宾身边之后，由于罗宾身上的触发器大小为18*18，所以加斯敏的身位判定框有可能会碰到罗宾身上的触发器。<br />而加斯敏的触发判定点半径为9，所以必然可以和触发器发生碰撞。<br />如果此时按下了A键，则后面的脚本就被触发了。<br /><br />如果此时触发了脚本，则：<br />首先把被触发的NPC——也就是罗宾——勾住。因为罗宾是四处闲逛的状态，和他对话的时候当然应该让他站住不动并且面向加斯敏。所以需要先将罗宾勾住。而加斯敏也应该站住不动，直到对完话之后再该干啥干啥。根据API手册，HookNPC()就可以实现这种效果。<br />然后是一个条件分支。<br />刚才说了，“事件触发”的条件是一个NPC的事件触发判定点和一个触发器的触发矩形区域发生碰撞，且按下A键。<br />那么，假如另一个NPC也站在罗宾身边，且凑巧也面向罗宾，如果这个时候你按下了A键，则那个NPC也满足触发条件了。这个时候到底是谁触发了罗宾身上的触发器呢？<br />为了方便称呼，当触发了关联在某个NPC身上的触发器时候，我们直接称呼为“触发了某NPC”。<br />我们设想得极端一些：假设杰拉尔德和阿历克斯站得很近，加斯敏和罗宾站得很近，此时你按下A键，那么，是加斯敏触发罗宾呢，还是杰拉尔德触发阿历克斯呢？<br />我们再极端一些：杰拉尔德和阿历克斯面对面站着。此时按下A键，那么，是杰拉尔德触发阿历克斯呢，还是阿历克斯触发杰拉尔德呢？<br /><br />——那啥，你等一下！不是只有主角才能触发NPC么？<br />谁告诉你只有主角才能触发NPC？还有，RMDS里面不都是NPC么？哪来的“主角”？<br />——呃……那个……<br />既然都是NPC，那就完全分不清了。反正都是“一个NPC触发另一个NPC”。<br /><br />为了避免上面那种混乱情况，此时就需要判断了。到底是谁触发了谁？<br />RMDS中有几个预先定义好的全局变量。其中，“G_TRIGGER_NPC”这个全局变量就是“触发者”的ID，“G_TRIGGERED_NPC”这个全局变量则是“被触发者”的ID。<br />那么，上面的脚本就很容易理解了：只有当“触发者”的ID=0的时候，也就是触发者是加斯敏的时候，才执行脚本的内容，否则直接跳过脚本。<br />由此可见，如果某个别的NPC也站在罗宾身边，而且满足触发条件，由于那个NPC的ID不是0号，所以脚本就被直接跳过去了。<br /><br />一般的RPG，场景中的NPC都比较傻，只有主角才能触发NPC，别的NPC不应该能够触发NPC。在这种情况下，可以将所有NPC的触发脚本都加上这个条件判断，看是不是主角触发了他。是，则执行脚本；否，则跳过脚本。<br /><br />OK，继续讲解脚本。<br />假设确实是加斯敏触发了罗宾。<br />于是开始显示对话文本。根据API，文本会在加斯敏的身边显示出来，并且显示第5号头像，同时播放第9号音效。显示完之后脚本暂停，等你按A键。<br />于是加斯敏和罗宾开始对话了。<br />然后在罗宾的脑袋上显示第3号表情气泡。<br />等气泡消失之后继续对话。<br />最后脚本执行完，取消两个人“勾住”的状态，罗宾继续他的闲逛，加斯敏继续受到你的控制。<br /><br />这个例子演示了如何实现和NPC对话。你可以继续按照你的想象力丰富脚本。你可以读DEMO的脚本，看看DEMO是如果实现那些触发效果的。<br /><br />所有的剧情，都是由脚本和资源堆砌出来的。现在我们已经可以创造出一个场景和其中的NPC，也能够利用脚本控制剧情的发展。下一次我们就看一下一些控制场景的脚本，并且使用这些脚本让我们的场景更加活跃。少年们，做好准备吧！</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>掌叔</b><br/>
2009-08-30 14:44:26</p>
</div>
<div class="col-10">
<p>大家放心，视频教程我会继续做下去的。只是我现在还在磨合录制工具。</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>gyyfifafans</b><br/>
2009-08-30 16:45:07</p>
</div>
<div class="col-10">
<p>支持加感谢。。。。哈哈哈</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>meng_aq</b><br/>
2009-09-01 10:29:27</p>
</div>
<div class="col-10">
<p>最近没时间了，下次更新可能要等很久了？<br />希望下次回来，掌家能把坛里弄得更热闹就好了。</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>Isword</b><br/>
2009-09-01 17:40:09</p>
</div>
<div class="col-10">
<p>期待DS版</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>白痴</b><br/>
2009-09-01 19:43:10</p>
</div>
<div class="col-10">
<p>期待 功能和界面上是不是和RPG MAKER差不多啊？</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>xiaokaixuan</b><br/>
2009-08-31 13:18:50</p>
</div>
<div class="col-10">
<p>哈哈哈哈   好！</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>25705556</b><br/>
2009-08-31 19:52:33</p>
</div>
<div class="col-10">
<p>啥都不说了~本人以前是很厌恶回帖的~因为许多地方都是，只要回帖之后才可以下载~往往让人感觉很被动~但是这里真的很不一样~同时希望willreno以后可以开发出更多更好的自制软件。</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>samvel1985</b><br/>
2009-08-31 23:08:05</p>
</div>
<div class="col-10">
<p>dfafdgdgadgaagaegwgwadsgwe</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>samvel1985</b><br/>
2009-08-31 23:08:58</p>
</div>
<div class="col-10">
<p>dsfasfasfasfasf</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>白枫</b><br/>
2010-01-06 22:09:38</p>
</div>
<div class="col-10">
<p>最后我还是进来看了</p>
</div>
</div>


            
            <div class="row">
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center">
                    <!--<li class="page-item disabled">
                        <a class="page-link">Previous</a>
                    </li>
                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">Next</a>
                    </li>
                        -->
                        <li class="page-item active">
<a class="page-link" href="post16487_1.html">1</a>
</li>


                    </ul>
                </nav>
            </div>
        </div>


        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    </body>
</html>

