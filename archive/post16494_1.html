
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>RMDS教程（四）——人造人ホムンクルス</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    </head>

    <body style="margin-top:1.618%">
        <div class="container">
            <div class="row">
                <div class="jumbotron">
                    <h1 class="display-5">RMDS教程（四）——人造人ホムンクルス</h1>
                </div>
                <br />
                <nav class="nav">
                    <a class="nav-link active" aria-current="page" href="index_17.html">返回</a>
                </nav>
            </div>

            <hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>雷精灵</b><br/>
2009-08-25 18:43:16</p>
</div>
<div class="col-10">
<p>RMDS中，最复杂的模块就是世界模块。<br /><br />世界模块，顾名思义，就是故事发生的整个世界。世界由两大元素构成——[color=blue]场景[/color]和[color=blue]事件[/color]。场景相当于一个容器，一切可以看到的东西都在这个容器中。而事件则驱动这个容器中的东西按照你的想法进行发展。我们先来看这个场景容器中都有什么东西。<br /><br />首先是“[color=red]地图[/color]”。<br />这个不用我多解释。地图是一种资源。当引擎载入地图资源之后，就会在屏幕上显示出地图。至于地图有多大，显示地图的什么区域，有没有什么特效，这些你暂时不需要操心，等到真正控制这个地图的时候，脚本会帮你完成。<br />然后是“[color=red]摄像机[/color]”。<br />这个需要解释一下。RMDS是2D RPG引擎，所以这个“摄像机”不是3D游戏中的那个摄像机。怎么解释呢？这么说吧：地图很大，但是我们的DS屏幕却只有256*192这么大。这个时候怎么显示地图呢？没办法，只能显示出地图的一部分。于是你就可以想象成有一个DS屏幕这么大的摄像机镜头，正在对准地图进行拍摄，展现在观众面前的，也就是你所看到的，就是摄像机拍摄的那一块地图。如果你移动摄像机，那么拍摄出来的地图也就跟着移动。这就是我们这个RMDS中的“摄像机”。至于怎么移动摄像机，你也暂时不用操心，脚本会帮你完成。<br />接着是“[color=red]NPC[/color]”。<br />这个我得详细解释。NPC一般被解释成“Non-Player-Controlled”，也就是“非玩家控制的角色”。不过，在RMDS中不是这样。RMDS中没有“主角”，也没有“场景精灵”，一切“可以活动的物体”都是NPC。<br />（某人：哎？没有主角？那我控制谁啊？）<br />你要记住，在RMDS中，不管是谁，只要它是NPC，你都能控制。只要一句简单的脚本，你就可以想控制谁就控制谁。当然，为了解释起来方便，以后我们依然把那位“被我们控制”的NPC称为“主角”。你在心里记着它实际上还是NPC就行了。<br />由于所有可活动物体都是NPC，所有NPC都能够受到我们的控制，所以在RMDS中很容易就能做到“同时控制多个主角”。具体方法到时候我们再慢慢研究。<br />最后是“[color=red]触发器[/color]”。<br />这个概念诸位或许比较陌生。因为游戏中看不见这种东西。我用具体例子来讲解。<br />比如主角走到房间门口，进入另一个场景。<br />比如主角站在柜台外面，和奸商讨价还价。<br />比如主角调查墙壁上的布告，发现自己干的坏事被曝光了，正在被官府通缉。<br />……我们知道，游戏的进程是由脚本控制的。也就是说，上面那些例子，实际上是触发了某些脚本，于是脚本执行，继续展开剧情。<br />触发器就是实现这种方法的一个对象。它是一个矩形，如果主角“触发”了这个矩形，那么执行这个矩形关联的脚本。矩形的坐标、宽高、关联的脚本都由你来控制。至于如何“触发”这个矩形，也由你来控制。<br /><br />所有这些东西，被装到容器中。这个容器，也就是我们的“场景”啦。<br />而通过对场景中的触发器进行触发，从而执行脚本，推动故事情节发展，这就是“事件”啦。<br /><br />OK。这一次教程，我们先从“NPC”开始入手。<br /><br />RMDS使用的NPC资源是一种特殊的封装格式，这种文件格式的扩展名是.pak。这种文件和zip压缩文件比较相似，可以看作是一个“包”，里面包含了几个独立的文件。对于NPC资源来说，它的pak文件包内包含3个文件——调色盘（_Pal.bin）、精灵数据（_Sprite.bin）和配置文件（config.ini）。我们用“PAK文件管理器”打开DEMO中的NPC资源看一下：<br />[attach]1681[/attach]<br /><br />不过，这个工具仅仅是浏览并管理pak的工具，并不能编辑pak中的文件内容。如何才能制作新的NPC资源呢？有请今天的主角——精灵编辑器！<br /><br />你们知道“动画”是怎么做出来的吗？<br />——啥？<br />我的意思是说，我们看到的动画，为什么是会动的呢？<br />——你老年痴呆了？<br />囧！你们真不配合~~~~我想说的是，我们看到的动画，是用一张张静态的图，以很快的速度进行切换，从而产生动态效果。<br />——你到底想说什么？<br />操！教你们这群家伙真是费劲！我就想表达一个意思：RMDS中的NPC的各种动作，都是用一张张静态的图堆出来的。<br />——瀑布汗~~~2D游戏不都是这样的？这还要你解释吗？<br />（青筋暴露）<br />——好啦好啦，我们不拆你的台了，继续讲解吧。<br />这些静态的图，被称为“帧”。下面这个就是把所有帧合到一张图里面的效果。<br />[attach]1682[/attach]<br />——偷来的图？<br />嘘……别声张~~~~我没有获得作者的允许就把这张图拿过来用了。<br /><br />上面那张图，把所有的帧全都合到一起，像这样的单独的一张图，我们称之为“Sprite Sheet”。<br />不过，RMDS不能直接使用Sprite Sheet，需要稍微加工一下才能拿到精灵编辑器中进行编辑。<br />加工成什么样呢？做成GIF。<br />——GIF？你的意思是，把所有单独的帧都给抠出来，然后合成一个GIF？<br />完全正确。<br />——我明白了。用什么工具做GIF呢？<br />这个就随你便了。你喜欢用哪个就用哪个，哪个用起来顺手就用哪个。总之我要求最后做出来一个包含这张Sprite Sheet的所有帧的GIF。<br />——了解。那么，开工吧！ImageReady和Fireworks之类的软件我可是用得相当熟练~~~<br /><br />注意，这个GIF的尺寸是有要求的。DS硬件只支持若干种大小的精灵，所以我们做的NPC也必须遵守这个限制要求。你做出来的GIF，只能是：[table=50%][tr][td]8*8[/td][td]16*8[/td][td]32*8[/td][td][/td][/tr][tr][td]8*16[/td][td]16*16[/td][td]32*16[/td][td][/td][/tr][tr][td]8*32[/td][td]16*32[/td][td]32*32[/td][td]64*32[/td][/tr][tr][td][/td][td][/td][td]32*64[/td][td]64*64[/td][/tr][/table]<br /><br />所以，在制作的时候请注意调整尺寸。此外，顺便对齐每一帧，至少在播放GIF的时候看起来让人舒服才行。<br />——OK了。这是我做出来的效果。看看合适吗？<br />[attach]1683[/attach]<br />做的不错。嗯……很不错！以后就按照这样做。<br />——那啥，我这样排列所有的帧，没问题吧？没有什么要求面向下的帧必须在面向上的帧之前吧？<br />没有。完全没有。所有帧都可以随意排列。当然，为了方便管理，面向同一方向的同一列动作最好排布到一起。<br />——那啥，Sprite Sheet里面有几帧我觉得没什么用处，不加进去没问题吧？<br />当然没问题！你用到哪一帧就加进去哪一帧。加那些用不到的帧干啥？浪费空间浪费内存……<br />——那么现在再怎么做？<br />下面的一步比较关键。将所有的帧，导出为一张“胶片”。<br />——哎？什么叫“胶片”？<br />你看这个就知道了。<br />[attach]1684[/attach]<br />——囧……真长！<br />嗯。加斯敏的NPC资源一共有125帧，每帧的大小都是32*32，所以这张胶片就是32*4000这么大。超级长。<br />——能不能分成几列？比如排成一个方阵……<br />不能！绝对不能！不仅不能分成几列，甚至不允许横着排胶片！必须竖着！<br />——真囧……为什么要这样？<br />精灵编辑器只能识别这样排列的图片。<br />——瀑布汗~~~精灵编辑器不是你写的吗？你多花点功夫让它支持方阵不就万事大吉了吗？<br />滚！我说“不支持”，你能把我怎么着？<br />——いやだよ～～～見て見て，那边有个小黑屋，我们去交流交流、沟通沟通，如何？ね、ね、どうだ？<br />[attach]1685[/attach]介个嘛……让我考虑一下~~~<br /><br />导出胶片之后就可以放到PS中进行最后的处理了。<br />——还要做些什么工作？<br />首先就是透明掉底色。<br />——啊！对了！透明！上次你挖的坑还没埋呢。<br />嗯。这一次我们就把这个坑埋了。<br /><br />用PS打开刚才的胶片。<br />[attach]1686[/attach]<br />老样子，不管是不是“RGB颜色”，统统转成“RGB颜色”。<br />——嗯。然后再转成“索引色”……<br />不，先别急。你看，我们的胶片，没有底色。背景是透明的。<br />——哦？真的哎！那么说，现在可以直接用了？<br />不，DS不支持带有Alpha通道或透明像素的PNG。所以我们还是得把它保存成BMP。<br />——但是保存成BMP之后透明的背景就变成白色了。<br />没错。为了避免这种情况，我们先把底色填充为粉色，0xFF00FF。<br />——怎么做？<br />现在你的胶片是RGB颜色了吧？工具箱，点击“设置背景色”，将背景色改为0xFF00FF。<br />[attach]1687[/attach]<br />然后菜单-图层-新建-图层背景。看吧！<br />——嗯。搞定了。然后呢？<br />然后就可以转为索引色了。<br />菜单-图像-模式-索引颜色。<br />老方法，设法让“颜色”那个值小于256。<br />——可以等于256吗？<br />嗯……最好不要。其实255色和256色就只差了1个颜色，在DS上，可以说，完全看不出来的。<br />——了解啦。现在我这张图是这样：<br />[attach]1688[/attach]<br />很好。下面就到了使这张图的背景变透明的最关键的步骤了！<br />看那个“强制(F)”，不要选择其他的，必须选择“自定...”。<br />——哎？弹出一个“强制颜色”对话框。<br />此时点击第0号颜色的那个格子。<br />——哎？又弹出个拾色器对话框。<br />此时选择粉色——0xFF00FF，然后确定。<br />[attach]1689[/attach]<br />——然后呢？<br />然后一路确定，保存为8bit BMP就行了。<br />——啊~~~就这样？我还以为有多难呢！<br />确实很简单。熟练的话可以在10秒钟之内完成从导入胶片到保存为8Bit BMP的全部步骤。<br /><br />[基础知识]<br />刚才的那个步骤就是将背景底色，也就是粉色（0xFF00FF）转化为透明色的方法。<br />GBA/DS不支持透明色，也不支持带有Alpha通道的位图数据。所以正常情况下是无法显示带有透明区域的图像的。但是，GBA/DS的硬件规定：调色盘的第0号颜色，不管是什么颜色，在显示的时候，一概不会显示出来。根据这个特性，如果我们在处理图片的时候，设法把希望透明的区域用某种颜色填充，然后再设法把那种颜色安排到调色盘的第0号位置，那么在GBA/DS上就能完全实现透明掉这块区域。<br />幸好PS支持强制设定调色盘的颜色。刚才我们的操作中，就是强制让第0号颜色为粉色。那么，以后在显示的时候，只要是粉色，都会被透明掉。<br /><br />——我有个疑问。<br />你说吧。<br />——既然PS可以强制设定调色盘的颜色，那么假如，我不仅将第0号颜色设定为粉色，也将第1号颜色设定为粉色~~~也就是说，调色盘中有重复的颜色出现。这个时候会有什么后果呢？<br />嗯……理论上来说，这是完全没问题的。PS在保存的时候，会对整个索引色BMP进行优化。你多出来的那号颜色，相当于完全废掉了。<br />——哦！那就OK了。<br />[/基础知识]<br /><br />现在转好的BMP已经有了，我们将这张BMP导入精灵编辑器，开始制作NPC资源。<br />打开精灵编辑器，菜单-文件-新建PAK，导入你刚才转好的那张BMP。<br />[attach]1690[/attach]<br />然后给这个NPC取个名字。名字可以随便取，中文也无妨。这个名字在目前版本的引擎中无意义，所以随便你怎么写，甚至不写，都是可以的。<br />然后确定NPC的帧数。警告：这个值必须等于你那个GIF的总帧数，绝对不能比它大，否则会多出几个黑色的“废帧”；也决不能比它小，否则会丢帧。<br />然后选择NPC的大小。刚才我说过了，DS的硬件只支持若干种大小的精灵，所以要求你精确处理GIF的尺寸大小。我们做的这个GIF是32*32的，所以这里选择“0x2 - 32x32”。<br />然后设置优先级。在绝大多数情况下这个值都要填“3”。引擎会根据这个值安排NPC所处的层次。<br />然后设置NPC特效模式。在绝大多数情况下这个值都要设置为“0 - OBJMODE_NORMAL”。使用了这种模式的NPC，在显示的时候才会是正常的。有些特效精灵，可能会用到下面两种模式，到时候我再进行讲解。注意，一般情况下绝不要设置为最后一个值。否则精灵会出现严重问题。只有在某些非常罕见的情况下才要求设置为这个值。到时候我会进行讲解。<br />最后确定。<br /><br />看！所有的帧都被拆开了。<br />[attach]1691[/attach]<br /><br />然后我们就可以给这个NPC设置动作了。<br />这里引入一个新名词：动作序列。<br />什么是动作序列呢？比如“走”这个动作吧。我们可以看一下，加斯敏的“面向下方走”这个动作，从第29帧开始到第34帧结束。如果我们能够把这些帧连起来然后播放出来，那毫无疑问就是“向下走”的动画了。我们将从第29帧到第34帧这一系列帧连起来，称为一个“动作序列”。这个动作序列的名称叫做“WALK_S”，那个S代表South，就是面朝南的意思。<br />那么，我们怎么把这些帧连起来呢？<br />首先在下拉列表中选中“WALK_S”，表示我们将要开始制作WALK_S的动作序列内容。<br />然后拖动滚动条或者点击滚动条两边的按钮，找到第29帧。<br />双击第29帧。<br />看！右下方的列表中多出一项！<br />[attach]1692[/attach]<br />然后双击第30帧，于是又多出一项。<br />——啊！我明白了！双击上面的帧，就相当于把那一帧添加到选定的动作序列中。<br />非常正确。事实上，是“插入”选定的动作序列。你可以点击右下方的列表改变插入位置。每次双击上方的帧，都会把那一帧插入动作序列光标所在处。<br />——嗯~~~我把WALK_S的动作序列做完了。不过，最上面一帧应该是第29帧而不是第0帧，应该把它删掉……<br />那就选中列表中的最上面那一帧，然后按Del键……<br />——哦！真是太方便了。<br />然后你可以播放看看效果。也可以调节播放速度。基本上，这个速度和在真机上的速度差不多。不过要注意一点，这个速度是个“全局变量”，也就是说这个速度会影响所有动作序列。<br />——那么我想让“走”播放得慢一些，“跑”播放得快一些，怎么做呢？<br />让“走”的每一帧多重复几次……<br />——嗯……我把所有的动作序列都做完了。不过后面还有几个E0到E3的每个方向上的动作序列。这些是干啥用的？<br />预留出来以作他用。因为引擎只定义了3种动作序列：静止、走和跑。对于那些没定义的动作比如加斯敏躺在地上的那一帧，应该写到哪个动作序列中呢？<br />——哦！这个时候就可以把这些没定义的帧写到这里了~~~<br />对。到时候可以通过专门的脚本进行调用。<br />——不过，每个方向上只预留出4个动作序列，有可能不太够用吧？<br />有可能。不过我们有一些邪恶的技巧可以设法避免过去。到时候我再进行讲解~~~<br /><br />现在所有的动作序列都做完了，我们还需要进行一些额外的设置。菜单-视图-精灵判定相关属性。<br />[attach]1693[/attach]<br /><br />名词解释——脚底中心坐标。<br />在世界模块中，给NPC一个坐标，则NPC就会显示在那个坐标处。不过，这个坐标是以哪个点定位的？左上角？头？脚？还是这一帧的中心？都不是。这个点由你来确定。<br />把图放大，你会看到左上角出现一个闪烁的黑点。那个点就代表了定位点。修改这个坐标值就可以移动黑点。对于RPG来说，我们倾向于把这个中心点定在NPC的两脚中间。换句话说，以后在写脚本的时候，你赋给NPC的坐标值，就是NPC“站”在那个地方的坐标点。对于我们这个加斯敏的例子来说，这个中心点可以设定为(16,24)。<br /><br />名词解释——身位判定框。<br />在世界模块中，NPC在移动的时候是可以被墙壁、树木还有其他NPC挡住的。这是怎么实现的呢？这其实是“身位判定框”在起作用。<br />身位判定框是个矩形。当NPC移动的时候，身位判定框也跟着移动。如果NPC在移动的过程中，他的身位判定框和其他对象的判定框——不管是地图的通行判定框还是其他NPC的身位判定框——发生碰撞的话，则阻止NPC继续移动。所以在我们看来，这个世界其实非常简单，就是一堆矩形而已。NPC在世界中移动，其实就是矩形在矩形堆中的移动。<br />身位判定框描述了NPC的“体积”，或者说，“占地面积”。比如地图中某些狭窄的区域，如果NPC的身位判定框比较大的话可能无法通过。<br />对于我们这个加斯敏的例子来说，身位判定框的参数值可以设定为(9,17,14,14)。<br /><br />名词解释——事件触发判定点。<br />当NPC和其他NPC对话的时候，我怎么知道这个NPC走到另一个NPC身边了？这是通过触发判定点实现的。<br />触发判定点其实是8个点。这8个点分别对应着8个方向，以NPC的脚底中心坐标为圆心，排列成一个圆形。如果NPC在移动的时候，他所面向的方向上的触发判定点和其他NPC的身位判定框发生碰撞，则认为NPC可以触发那个NPC。<br />很明显，这个值越大，说明这个NPC的“触发范围”越广。他可以大老远就能和其他NPC交谈……<br />很明显，如果这个值过小，比如处于身位判定框内部，则由于身位判定框的阻挡作用，这个NPC将永远无法触发其他NPC。这一点很重要。在游戏中那些真正意义上的NPC，只要求他们傻傻地干自己的事情就行了，不要求他们聪明到能够去触发别人，这个时候就要把他们的事件触发判定点“缩进”身位判定框内部。<br />对于“主角”来说，这个判定点当然不能缩进自己的身位判定框内，否则就无法触发别人了。如果你打算让加斯敏当做主角，那么推荐这个值设定为9。<br />[attach]1694[/attach]<br /><br />行了，大功告成！关闭这个窗口，然后菜单-文件-另存为，取个名字就行了。我们可爱的加斯敏就诞生了。<br />——啊~~~做NPC也不难嘛！除了刚才一帧一帧做动作序列的时候稍微有点麻烦之外，其他地方根本没有难度嘛！<br />那当然！精灵编辑器可是我的得意作品！<br />保存完之后，我们就可以用脚本调用了。下次的教程就会让可爱的加斯敏以主角的方式出现在游戏中，大家准备好吧！<br /><br />[b]附加工具下载：[/b]<br />PAK文件管理器：[attach]1696[/attach]<br />精灵编辑器：[attach]1695[/attach]</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>Isword</b><br/>
2009-08-25 18:50:51</p>
</div>
<div class="col-10">
<p>不愧是“雷”叔啊~</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>Isword</b><br/>
2009-08-25 19:03:48</p>
</div>
<div class="col-10">
<p>沙发，支持雷叔</p>
</div>
</div>


            
            <div class="row">
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center">
                    <!--<li class="page-item disabled">
                        <a class="page-link">Previous</a>
                    </li>
                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">Next</a>
                    </li>
                        -->
                        <li class="page-item active">
<a class="page-link" href="post16494_1.html">1</a>
</li>


                    </ul>
                </nav>
            </div>
        </div>


        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    </body>
</html>

