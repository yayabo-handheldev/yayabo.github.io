
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>RMDS教程（三）——理解、分解、再构建</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    </head>

    <body style="margin-top:1.618%">
        <div class="container">
            <div class="row">
                <div class="jumbotron">
                    <h1 class="display-5">RMDS教程（三）——理解、分解、再构建</h1>
                </div>
                <br />
                <nav class="nav">
                    <a class="nav-link active" aria-current="page" href="index_17.html">返回</a>
                </nav>
            </div>

            <hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>雷精灵</b><br/>
2009-08-19 11:53:38</p>
</div>
<div class="col-10">
<p>从引擎的角度来看，菜单模块相当于Logo模块多加了一些东西，因此Logo模块中能用的API，在菜单模块中也能用。<br /><br />我们先来看DEMO的菜单模块。<br />当Logo显示完之后，切换模块到菜单模块，并且调用/menu/MenuModuleStartUp.lua这个脚本。<br /><br />打开脚本：<br />[code=rmds]<br />DisplayImage("/menu/title.bin",1,0,0,true)<br />DisplayImage("/menu/PressStart.bin",-1,0,0,true)<br /><br />FadeFX(0,0,0,0)<br /><br />CreateMenuItem(0,"新游戏",128,48,0,0,256,96)<br />CreateMenuItem(1,"继续游戏",128,144,0,96,256,96)<br /><br />local menu=GetSelectedMenu()<br />if menu==1 then<br />	LoadGame()<br />else<br />	G_STAGE=0<br />end<br /><br />FadeFX(0,0,-16,4)<br /><br />SwitchModule(MODULE_WORLD,"/world/WorldModuleStartUp.lua")<br />[/code]<br /><br />首先显示两张图片并设置亮度为正常。这两张图片就是标题画面和下屏背景图。<br />然后开始创建菜单项。<br />创建完两个菜单项之后，由于GetSelectedMenu()这个函数的作用，脚本暂停执行，等待玩家选择菜单。<br />所谓“菜单”其实就是一个图标和它下面的说明文字。由于只能通过点击才可以触发菜单项，所以创建出来的菜单项必定在下屏。<br />菜单项可以设置所谓的“热点区域”，也就是说，如果点击到了这个区域，则被判定为“触发了该菜单”。<br />当菜单项被触发之后，引擎会令菜单项的图标动态缩放，以指示该菜单项被触发。<br />当被触发的菜单项再次被点中后，此时GetSelectedMenu()则会返回该菜单项的ID。脚本继续执行。<br />紧接着就根据返回值决定游戏的进程了。<br /><br />注意，当前版本的引擎只有“创建菜单项”的函数，而没有“删除菜单项”的函数。所以无法实现运行中更改菜单项的数量。以后的版本或许会增加这样的功能。<br /><br />创建菜单项的时候出现了一个新的概念——图标。<br />图标也是一种资源，可以用“图标编辑器”生成。<br />若干个图标被编辑器打包成一个.bin文件，在这个文件中图标被按照文件名的顺序进行排列，并通过ID号进行访问。<br /><br />RMDS中用到图标的地方很多，比如世界模块中的人物对话头像，就属于图标。不同用途的图标，其名称和要求也不一样。对于菜单模块下，用于显示菜单项的图标，要求图片为大小=32*32，颜色=4位索引色的bmp。打包成.bin之后，需要改名为menuIcon.bin，并且要求放在根目录下。<br /><br />我们来实际操作一下。<br />首先准备图标资源图片。<br />偷一下懒吧，还是用原来的那两个图标。<br />[attach]1653[/attach]和[attach]1654[/attach]。<br /><br />注意，正如刚才我所说的，图标必须是32*32大小，颜色=4位索引色。<br /><br />（某人：什么叫“4位索引色”？）<br />这个问题不太好解释，我们到PS里面看看就知道了。<br /><br />用PS打开图标，菜单-图像-模式，看到了么？“索引颜色”和“RGB颜色”！看看你的那张图，对号勾在什么地方。<br />[attach]1655[/attach]<br />如果勾在“索引颜色”上，那么这张图就是索引色。但是，却不一定是“4位”索引色。<br /><br />（某人：那么，怎么做成所谓的“4位”索引色呢？）<br />很简单。菜单-图像-模式-RGB颜色，先把这张图转化成RGB色。<br /><br />（某人：哎？我们不是要索引色么？怎么要转化成RGB色了？）<br />先别管那么多，转化成RGB色再说。<br /><br />（某人：那个……我这张图本来就是RGB色……）<br />那就省了这步了。<br /><br />总之，现在我们的图标是RGB色了。<br /><br />然后，菜单-图像-模式-索引颜色，再把这张图转化成索引色。<br />（某人：你是不是闲的蛋疼……）<br /><br />别误会，你先转化了再说。<br />（某人：……哦？出来一个对话框。）<br />[attach]1656[/attach]<br /><br />注意那个“颜色(C)：12”。如果你的图片，这个值小于等于16，那么就太好了，直接点击确定，然后保存为BMP就行了。如果大于16则不是“4位索引色”，还需要进一步操作。<br /><br />现在我这张图，颜色小于16，因此可以直接确定，保存。<br />保存为BMP时会弹出这个对话框：<br />[attach]1657[/attach]<br />看到那个“4位”和“8位”的单选框了吗？选择4位就会保存成4位索引色，选择8位就会保存成8位索引色。<br />（某人：啊！原来如此！那么我就选择4位。其他按照默认就行了吧？）<br />呵呵呵……事实上，这里不管你选择4位还是8位，都没问题。<br />（某人：哎？）<br />放心吧，听我的没错，选择哪个都行。其他按照默认就可以了。<br /><br />嗯……严谨起见，我再导入一张颜色数可能超过16的图片，然后演示一下怎么“进一步操作”。<br />[attach]1658[/attach]<br />这是战斗模块用的指令按钮。我们看一下这张图的颜色。<br />[attach]1659[/attach]<br />嗯……44啊。我们要设法把这个值降到16或者16以下。<br /><br />我们来看“调板(L)”那个下拉框。<br />有3个“局部（***）”这样的选项。从这3个选项中随便选择一个。<br /><br />你会注意到“颜色(C)”变成可编辑的了。<br />[attach]1660[/attach]<br /><br />那还愣着干啥？填入“16”吧。点击确定。<br />[attach]1661[/attach]<br /><br />（某人：好像……画质变得稍微差了一点……）<br />那是当然的。刚才那张图是44色，现在改成16色，丢失了很多颜色，画质当然会变差。<br />（某人：啊？怎么会这样？怎么避免这种情况？）<br />无法避免。这个过程叫做“减色”，“减色”必然会降低画质。不过，在减色的过程中，“仿色(D)”变成可用。这是PS提供的一种用像素过渡的方法模拟被减掉的颜色的途径。你可以试着看看各个选项。根据情况的不同有可能能够在一定程度上恢复一些画质。<br />（某人：哦……这样啊~~~）<br /><br />然后就和刚才一样了，另存为BMP，BMP选项那里随便选。<br /><br />OK。图标资源有了，现在我们用工具把它们转成引擎可用的资源。<br /><br />新建一个文件夹，随便起名，把刚才保存好的图标复制过来，并且重命名。<br />（某人：重命名为什么？）<br />随便。只要保证[color=Red]它们按照文件名排列的顺序是你希望的图标顺序[/color]就行了。最简单的就是命名为数字。<br /><br />然后把图标打包器.exe和gfx2gba.exe复制过来放到同一个文件夹下。<br />现在这个文件夹就像这样：<br />[attach]1662[/attach]<br /><br />注意：图标打包器的工作原理是这样的：搜索[color=Red]它所在的文件夹[/color]，将[color=Red]所有找到的BMP文件[/color]按照[color=Red]文件名排序[/color]，然后逐一读取BMP数据，最后将数据进行整理打包，生成最终的资源。因此，在这个文件夹下，只能存在图标所用到的BMP，不准有其他作用的BMP。因为软件是不知道这些BMP是干啥用的。所以你必须管理好这个文件夹。<br /><br />整理好文件夹之后，双击“图标打包器.exe”。<br />[attach]1663[/attach]<br />左侧的列表就是软件找到的所有BMP。当生成资源之后，资源中的图标也将按照这个列表的顺序进行排序。<br />直接点击“刷新”。你或许会注意到有些一闪而过的黑色窗口。不用管它。等待一下。<br />此时你会发现，文件夹下出现了几个.raw文件。<br />这些文件是所谓的“临时文件”，不用管它们。<br />你会注意到，产生的临时文件的数量，正好是BMP文件数量的2倍。<br />此时再点击“打包”，于是瞬间所有的临时文件都消失了，同时文件夹下面出现一个“icon.bin”文件。这就是最终生成的资源。<br /><br />由于我们这个资源是用做菜单图标的，所以改名为“menuIcon.bin”。这个名字是引擎定死的，不要改成其他名字。<br /><br />OK！还是用上次那个老方法，创建出一个文件夹，把必要的引擎文件复制进去。<br />把menuIcon.bin复制到efsroot文件夹内，替换掉原来那个文件。<br /><br />然后在efsroot文件夹内新建menu文件夹，再在menu文件夹内新建MenuModuleStartUp.lua脚本文件。<br />写点什么呢？干脆也别劳神费心了，照抄原版。不过我们现在还没做到世界模块，所以先把最后一句话屏蔽。<br />还有那几个两个背景图的资源，我也懒得做了。反正你们都会做，这次我们直接借用demo的那两个资源，导出来后直接放到menu文件夹下就行了。<br />[code=rmds]<br />DisplayImage("/menu/title.bin",1,0,0,true)<br />DisplayImage("/menu/PressStart.bin",-1,0,0,true)<br /><br />FadeFX(0,0,0,0)<br /><br />CreateMenuItem(0,"新游戏",128,48,0,0,256,96)<br />CreateMenuItem(1,"继续游戏",128,144,0,96,256,96)<br /><br />local menu=GetSelectedMenu()<br />if menu==1 then<br />	LoadGame()<br />else<br />	G_STAGE=0<br />end<br /><br />FadeFX(0,0,-16,4)<br /><br />--SwitchModule(MODULE_WORLD,"/world/WorldModuleStartUp.lua")<br />[/code]<br /><br />顺便修改一下crt0.o.lua，直接进入菜单模块。<br />[code=rmds]<br />SwitchModule(MODULE_MENU,"/menu/MenuModuleStartUp.lua")<br />[/code]<br /><br />打包看效果吧。<br />[attach]1664[/attach]<br /><br />如何？很满意吧！你再随便修改一下坐标参数和热区参数，看看有什么变化。<br /><br />（某人：等等！我这边怎么变成这样了？那个粉红色的底色是怎么回事？）<br />[attach]1665[/attach]<br /><br />哦……这是因为你没有选择正确的“[color=Red]透明色[/color]”的缘故。<br />（某人：透明色？哦！我明白了。你的那张图中，粉红色是所谓的“透明色”，于是显示出来之后，那部分颜色就透明掉了。）<br />没错，就是这样。<br />（某人：怎么选择透明色？）<br />这个问题在PS中很容易实现。不过，这篇教程将不进行讲解。<br />（某人：为什么？）<br />选择透明色在DS中是一个非常普遍的操作。我们的引擎也是这样。想想看，一个NPC，身边居然有一圈粉红色的底色，那多囧rz！所以在下一次的教程中，教你们做地图和NPC的时候，我再教你们如何选择透明色。<br />（某人：哦……这样啊~~~）<br /><br />OK。菜单模块就这些东西。下一次我们将进入最神秘也是最复杂的世界模块。大家准备好吧！<br /><br />[b]附加工具下载：[/b]<br />图标打包器：[attach]1666[/attach]</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>lhy4tc</b><br/>
2009-08-18 22:11:58</p>
</div>
<div class="col-10">
<p>和他比咱手绘很渣-    -..同样是自学差别太大啦.<br />PS:现在网购很方便啦-_,-咱都是帮同学网购这方面的材料咯..</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>掌叔</b><br/>
2009-08-18 22:13:09</p>
</div>
<div class="col-10">
<p>我那个时候还不知道互联网是啥，也没碰过电脑……<br />ps，一大把年纪了我……</p>
</div>
</div>

<hr class="my-4" />
<div class="row">
<div class="col-2">
<p><b>masjak</b><br/>
2009-08-19 00:29:00</p>
</div>
<div class="col-10">
<p>那里可下到这个软件呢</p>
</div>
</div>


            
            <div class="row">
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center">
                    <!--<li class="page-item disabled">
                        <a class="page-link">Previous</a>
                    </li>
                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">Next</a>
                    </li>
                        -->
                        <li class="page-item active">
<a class="page-link" href="post16509_1.html">1</a>
</li>


                    </ul>
                </nav>
            </div>
        </div>


        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    </body>
</html>

